'use strict';var HL={TAB:0,AJ:1,WZ:2},IL=function(a){gh("MediaRouter.WebRtc.Start.Success",a,HL)};var JL=function(a,b){Ih.call(this,b);this.Mb=a;this.Bi=new Ec;this.ec=Lg.gw(b.id);this.Gd=new Ec;this.ie=!1;this.Ne=null;this.AE=!1;this.fe=this.ss=null;this.Bt();this.cI();this.Xb(new Lh("GET_TURN_CREDENTIALS"))};ja(JL,Ih);d=JL.prototype;
d.start=function(a){var b=this;return this.Bi.promise.then(function(c){if(c.Jj())return Promise.reject(new jh("Mirroring already started"));if(b.Ne)return Promise.reject(new jh("Session permanently stopped"));b.ss=new Yg("MediaRouter.WebRtc.Session.Launch");c.addStream(a);c.start();return b.Gd.promise})};
d.stop=function(){var a=this;this.Gd.reject(new jh("Session stop requested."));this.fe&&(this.fe.end(),this.fe=null);if(this.Ne)return this.Ne;this.AE=this.ie=!1;this.ss=null;return this.Ne=this.Bi.promise.then(function(a){a.stop()}).then(function(){return a.ec.fb()}).catch(function(b){a.ec.fb();throw b;})};
d.Bt=function(){var a=this;this.ec.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.Bi.resolve(new Ph(a.Gb.id,b.data.credentials));break;case "ANSWER":a.Bi.promise.then(function(a){a.setRemoteDescription(b.data)});break;case "KNOCK_ANSWER":a.AE=!0;a.Bi.promise.then(function(a){a.setRemoteDescription(b.data)});break;case "STOP":a.Gd.reject(new jh("Stop signal received"));a.stop();break;default:throw new jh("Unknown message type: "+b.type);
}}};d.cI=function(){var a=this;this.Bi.promise.then(function(b){b.JW(function(b){a.Xb(new Lh("OFFER",new Nh(b,a.Mb,Oh)))});b.IW(function(b){a.Xb(Mh(b))});b.HW(function(){a.ie=!0;a.Xb(new Lh("SESSION_START_SUCCESS"));!a.AE&&a.ss&&a.ss.end();a.ss=null;a.fe=new ch("MediaRouter.WebRtc.Session.Length");a.Gd.resolve(a)});b.FW(function(){a.Xb(new Lh("SESSION_END"))});b.GW(function(b){a.ie||a.Gd.reject(b);a.Xb(new Lh("SESSION_FAILURE"))})})};d.Xb=function(a){this.ec.sendMessage(a,KL)};var KL={channelType:"cloud"};var LL=function(){Gh.call(this,"webrtc")};ja(LL,Gh);d=LL.prototype;d.hv=function(a,b){return new JL(a,b)};d.Zx=function(){IL(0)};d.Vx=function(){IL(1)};d.EG=function(){IL(2)};d.Wx=function(){fh("MediaRouter.WebRtc.Session.End")};d.Xx=function(a){gh("MediaRouter.WebRtc.Start.Failure",a,ih)};d.Yx=function(){fh("MediaRouter.WebRtc.Stream.End")};var ML=new LL;Eh("mr.mirror.webrtc.WebRtcService",ML);
